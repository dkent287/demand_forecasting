library(forecast)
library(Metrics)

# reproducing disguised but representative data
df <- structure(list(index = c("2018-03-25", "2018-04-01", "2018-04-08", 
                               "2018-04-15", "2018-04-22", "2018-04-29", "2018-05-06", "2018-05-13", 
                               "2018-05-20", "2018-05-27", "2018-06-03", "2018-06-10", "2018-06-17", 
                               "2018-06-24", "2018-07-01", "2018-07-08", "2018-07-15", "2018-07-22", 
                               "2018-07-29", "2018-08-05", "2018-08-12", "2018-08-19", "2018-08-26", 
                               "2018-09-02", "2018-09-09", "2018-09-16", "2018-09-23", "2018-09-30", 
                               "2018-10-07", "2018-10-14", "2018-10-21", "2018-10-28", "2018-11-04", 
                               "2018-11-11", "2018-11-18", "2018-11-25", "2018-12-02", "2018-12-09", 
                               "2018-12-16", "2018-12-23", "2018-12-30", "2019-01-06", "2019-01-13", 
                               "2019-01-20", "2019-01-27", "2019-02-03", "2019-02-10", "2019-02-17", 
                               "2019-02-24", "2019-03-03", "2019-03-10", "2019-03-17", "2019-03-24", 
                               "2019-03-31", "2019-04-07", "2019-04-14", "2019-04-21", "2019-04-28", 
                               "2019-05-05", "2019-05-12", "2019-05-19", "2019-05-26", "2019-06-02", 
                               "2019-06-09", "2019-06-16", "2019-06-23", "2019-06-30", "2019-07-07", 
                               "2019-07-14", "2019-07-21", "2019-07-28", "2019-08-04", "2019-08-11", 
                               "2019-08-18", "2019-08-25", "2019-09-01", "2019-09-08", "2019-09-15", 
                               "2019-09-22", "2019-09-29", "2019-10-06", "2019-10-13", "2019-10-20", 
                               "2019-10-27", "2019-11-03", "2019-11-10", "2019-11-17", "2019-11-24", 
                               "2019-12-01", "2019-12-08", "2019-12-15", "2019-12-22", "2019-12-29", 
                               "2020-01-05", "2020-01-12", "2020-01-19", "2020-01-26", "2020-02-02", 
                               "2020-02-09", "2020-02-16", "2020-02-23", "2020-03-01", "2020-03-08", 
                               "2020-03-15", "2020-03-22", "2020-03-29", "2020-04-05", "2020-04-12", 
                               "2020-04-19", "2020-04-26", "2020-05-03", "2020-05-10", "2020-05-17", 
                               "2020-05-24", "2020-05-31", "2020-06-07", "2020-06-14", "2020-06-21", 
                               "2020-06-28", "2020-07-05", "2020-07-12", "2020-07-19", "2020-07-26", 
                               "2020-08-02", "2020-08-09", "2020-08-16", "2020-08-23", "2020-08-30", 
                               "2020-09-06", "2020-09-13", "2020-09-20", "2020-09-27", "2020-10-04", 
                               "2020-10-11", "2020-10-18", "2020-10-25", "2020-11-01", "2020-11-08", 
                               "2020-11-15", "2020-11-22", "2020-11-29", "2020-12-06", "2020-12-13", 
                               "2020-12-20", "2020-12-27", "2021-01-03"), Value = c(171954L, 
                                                                                    175983L, 182176L, 204762L, 190414L, 164509L, 189951L, 185431L, 
                                                                                    178109L, 144890L, 179893L, 165309L, 161598L, 190336L, 161705L, 
                                                                                    185468L, 169414L, 174090L, 182590L, 170937L, 177440L, 167498L, 
                                                                                    177016L, 166978L, 178701L, 197804L, 165459L, 180387L, 177362L, 
                                                                                    188070L, 139737L, 172630L, 181116L, 187739L, 141067L, 159493L, 
                                                                                    172005L, 156852L, 170582L, 108981L, 139398L, 164715L, 180208L, 
                                                                                    165578L, 150432L, 172456L, 157376L, 160747L, 181247L, 140209L, 
                                                                                    180778L, 174823L, 150521L, 158542L, 193693L, 177645L, 192286L, 
                                                                                    181307L, 186313L, 178737L, 191977L, 169959L, 158697L, 158528L, 
                                                                                    173406L, 191186L, 164444L, 208979L, 182001L, 173436L, 156646L, 
                                                                                    149798L, 172527L, 147005L, 173555L, 152108L, 168979L, 139389L, 
                                                                                    129588L, 132264L, 127931L, 134254L, 126794L, 140317L, 132397L, 
                                                                                    146625L, 179995L, 140047L, 156938L, 152835L, 126538L, 65501L, 
                                                                                    92036L, 139105L, 109354L, 135210L, 111993L, 131422L, 145836L, 
                                                                                    155570L, 163386L, 133342L, 139931L, 132746L, 117022L, 115206L, 
                                                                                    100786L, 106724L, 104512L, 86032L, 110017L, 114749L, 129600L, 
                                                                                    116723L, 129644L, 105255L, 113663L, 102831L, 101171L, 122590L, 
                                                                                    136748L, 148711L, 137374L, 146122L, 160689L, 143843L, 112188L, 
                                                                                    122655L, 110471L, 151632L, 148495L, 152085L, 151113L, 139480L, 
                                                                                    152006L, 132432L, 139648L, 149403L, 158219L, 131722L, 139785L, 
                                                                                    154573L, 169083L, 119607L, 114054L, 161551L)), class = "data.frame", row.names = c(NA,-146L))


# Setting frequency to 7 (a week)
df <- ts(df$Value, frequency = 7)

# train/ test split
test_length <- 39
train <- head(df, length(df) - test_length)
test <- tail(df, test_length)

# creating an arima model
custom_model <- Arima(train,
                      order = c(2,1,2),
                      list(order=c(1,0,0),period=52), method="ML", include.mean=T)

# making forecasts
preds_custom <- forecast(custom_model,
                         h = test_length,
                         level = c(80, 95))

# plotting results from combined prediction
autoplot(preds_custom, main='Custom Model') + autolayer(test)

summary(custom_model)